(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{437:function(s,a,t){"use strict";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("持续创作，加速成长！这是我参与「掘金日新计划 · 10 月更文挑战」的第4天，"),a("a",{attrs:{href:"https://juejin.cn/post/7147654075599978532",title:"https://juejin.cn/post/7147654075599978532",target:"_blank",rel:"noopener noreferrer"}},[s._v("点击查看活动详情"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"一、渲染页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、渲染页面"}},[s._v("#")]),s._v(" 一、渲染页面")]),s._v(" "),a("p",[s._v("页面渲染过程是怎么样的呢？页面渲染大致分为五步，如下代码：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<style>\n    .wrap{\n       width: 100%;\n       height: 100%;\n       background-color: #bfa;\n    }\n    p{\n        font-size:30px;\n    }\n</style>\n​\n<div class="wrap">\n     <p class="title">hello world</p>\n</div>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("接下来一步一步彻底熟悉页面渲染：")]),s._v(" "),a("p",[a("strong",[s._v("1、HTML代码解析生成DOM树")])]),s._v(" "),a("p",[s._v("什么是DOM树?浏览器将HTML解析成树型的数据结构。解析树的根节点是Document对象，文本对象是最底层的节点。")]),s._v(" "),a("p",[s._v("先看上述代码的DOM虚拟结构：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var dom={\n     target:{\n                el:'div',\n                class:'wrap',\n                children:[\n                      {\n                            target:{\n                            el:'p',\n                            class:'title',\n                            value:'hello world'\n                           }\n                      }\n               ]\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("再看生成的DOM树（图为展示head节点的其余子节点）：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7a70f9342ef4cf9902d866f5d75bf81~tplv-k3u1fbpfcp-watermark.image?",alt:"image-20221017194654460.png"}})]),s._v(" "),a("p",[a("strong",[s._v("2、CSS代码解析生成CSSOM树")])]),s._v(" "),a("p",[s._v("什么是CSSOM树？当 CSS 下载完，通过CSS 解析器把 CSS 解析成 CSS 对象，然后把CSS 对象组装成 CSSOM 树。在浏览器构建 DOM 树的同时，如果样式也加载完成，则 CSSOM 树也在同步地构建。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("        var dom={\n            target:{\n                el:'div',\n                class:'wrap',\n                style:{\n                    width: '100%',\n                    height: '100%',\n                    backgroundColor: '#bfa'\n                },\n                children:[\n                    {\n                        target:{\n                            el:'div',\n                            class:'wrap',\n                            value:'wrap'\n                        }\n                    }\n                ]\n            }\n        }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("CSSOM树如下展示：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/288ac032fc9749d89ae2d237c1e61484~tplv-k3u1fbpfcp-watermark.image?",alt:"image-20221017200458247.png"}}),s._v("\n另外，CSSOM 树和 DOM 树是两个独立的数据结构，它们没有一一对应的关系。")]),s._v(" "),a("p",[a("strong",[s._v("3、结合DOM树 和CSSOM树，生成一个render树（"),a("em",[s._v("重排")]),s._v("）")])]),s._v(" "),a("p",[s._v("什么是render树？DOM树和CSSOM树都构建完成以后，浏览器会根据这两棵树生成一个渲染树。也就是吧HTML按照一定的布局和样式显示出来。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7df6bdd1dc0642f095ac8370201158c0~tplv-k3u1fbpfcp-watermark.image?",alt:"image-20221017210216077.png"}})]),s._v(" "),a("p",[a("strong",[s._v("4、布局,将渲染树的所有节点进行平面合成（页面依然没有渲染）（"),a("em",[s._v("重绘")]),s._v("）")])]),s._v(" "),a("p",[s._v("渲染树构建完成后，所有元素的位置关系以及对应的样式就已确定，同时浏览器会计算出所有元素的大小和绝对位置。")]),s._v(" "),a("p",[s._v("发生重绘，不一定会发生重排；发生重排，一定会发生重绘。")]),s._v(" "),a("p",[a("strong",[s._v("5、绘制页面到屏幕上（render-UI）")])]),s._v(" "),a("p",[s._v("布局计算完成后，浏览器就在页面上渲染元素，经过渲染引擎的处理后，整个页面就显示在屏幕。")]),s._v(" "),a("p",[s._v("整体过程如下图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/245a32c043b64016bd828a9a7ee39fac~tplv-k3u1fbpfcp-watermark.image?",alt:"image-20221017230633257.png"}})]),s._v(" "),a("h2",{attrs:{id:"二、渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、渲染"}},[s._v("#")]),s._v(" 二、渲染")]),s._v(" "),a("p",[s._v("网页生成的时候，至少渲染一次")]),s._v(" "),a("h2",{attrs:{id:"三、回流-重排"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、回流-重排"}},[s._v("#")]),s._v(" 三、回流（重排）")]),s._v(" "),a("p",[a("em",[s._v("所有导致元素几何信息发生变化的操作")]),s._v("。")]),s._v(" "),a("p",[s._v("当浏览器生成渲染树以后，就会根据渲染树来进行布局（回流），确定各个节点在页面的确切位置和尺寸大小。当元素属性发生改变且影响布局时（位置或尺寸发生改变），发生回流，相当于刷新页面。")]),s._v(" "),a("h3",{attrs:{id:"_1、发生重排的操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、发生重排的操作"}},[s._v("#")]),s._v(" 1、发生重排的操作")]),s._v(" "),a("p",[s._v("（1）window大小被修改")]),s._v(" "),a("p",[s._v("（2）增加或者删除DOM结构")]),s._v(" "),a("p",[s._v("（3）元素尺寸发生变化")]),s._v(" "),a("p",[s._v("（4） offsetWidth和offsetHeight,offset...;")]),s._v(" "),a("p",[s._v("clientWidth,clientHeight,client...;")]),s._v(" "),a("p",[s._v("scrollHeight,scrollTop,scroll...;")]),s._v(" "),a("h3",{attrs:{id:"_2、减少重排操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、减少重排操作"}},[s._v("#")]),s._v(" 2、减少重排操作")]),s._v(" "),a("p",[s._v("--元素脱离文档流")]),s._v(" "),a("p",[s._v("--改变样式")]),s._v(" "),a("p",[s._v("--回归文档流")]),s._v(" "),a("h2",{attrs:{id:"四、重绘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、重绘"}},[s._v("#")]),s._v(" 四、重绘")]),s._v(" "),a("p",[a("strong",[s._v("所有导致元素非几何信息发生变化的操作")]),s._v("。")]),s._v(" "),a("p",[s._v("当元素属性发生改变但不影响布局时（背景颜色、字体样式等发生改变），发生重绘，但不刷新页面，动态更新内容。")]),s._v(" "),a("h2",{attrs:{id:"五、浏览器的优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、浏览器的优化"}},[s._v("#")]),s._v(" 五、浏览器的优化")]),s._v(" "),a("p",[s._v("当改变元素的几何信息导致重排（回流）发生，浏览器提供一个渲染队列用于临时存储该次重排（回流），浏览器继续执行代码，如果还有几何信息修改，继续入队，直到没有样式修改，然后浏览器会按照浏览器渲染队列批量优化重排过程。")]),s._v(" "),a("p",[s._v("offsetWidth和offsetHeight,offset...;")]),s._v(" "),a("p",[s._v("clientWidth,clientHeight,client...;")]),s._v(" "),a("p",[s._v("scrollHeight,scrollTop,scroll...")]),s._v(" "),a("p",[s._v("会强制刷新渲染队列（立即执行修改任务）")]),s._v(" "),a("h2",{attrs:{id:"六、什么情况下会发生重排"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、什么情况下会发生重排"}},[s._v("#")]),s._v(" 六、什么情况下会发生重排？")]),s._v(" "),a("h3",{attrs:{id:"_1-导致回流的操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-导致回流的操作"}},[s._v("#")]),s._v(" （1）导致回流的操作")]),s._v(" "),a("p",[s._v("页面首次渲染")]),s._v(" "),a("p",[s._v("浏览器窗口大小发生改变")]),s._v(" "),a("p",[s._v("元素尺寸或位置发生改变")]),s._v(" "),a("p",[s._v("元素内容变化（文字数量或图片大小等等）")]),s._v(" "),a("p",[s._v("元素字体大小变化")]),s._v(" "),a("p",[s._v("添加或者删除可见的DOM元素")]),s._v(" "),a("p",[s._v("激活CSS伪类（例如：:hover）")]),s._v(" "),a("p",[s._v("查询某些属性或调用某些方法")]),s._v(" "),a("h3",{attrs:{id:"_2-导致回流的属性和方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-导致回流的属性和方法"}},[s._v("#")]),s._v(" （2）导致回流的属性和方法")]),s._v(" "),a("p",[s._v("属性：clientWidth、clientHeight、clientTop、clientLeft offsetWidth、offsetHeight、offsetTop、offsetLeft scrollWidth、scrollHeight、scrollTop、scrollLeft...")]),s._v(" "),a("p",[s._v("方法： scrollIntoView()、scrollIntoViewIfNeeded() getComputedStyle() getBoundingClientRect() scrollTo()...")]),s._v(" "),a("h3",{attrs:{id:"_3-导致回流的结构变化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-导致回流的结构变化"}},[s._v("#")]),s._v(" （3）导致回流的结构变化")]),s._v(" "),a("p",[s._v("节点的增加与删除，例如，若在body最前面插入一个元素，会导致整个文档的重绘渲染。")]),s._v(" "),a("h2",{attrs:{id:"七、如何减少页面重排与重绘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、如何减少页面重排与重绘"}},[s._v("#")]),s._v(" 七、如何减少页面重排与重绘？")]),s._v(" "),a("h3",{attrs:{id:"_1、css"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、css"}},[s._v("#")]),s._v(" 1、CSS")]),s._v(" "),a("p",[s._v("（1）避免使用table布局。")]),s._v(" "),a("p",[s._v("（2）尽可能在DOM树的最末端改变class。")]),s._v(" "),a("p",[s._v("（3）避免设置多层内联样式。")]),s._v(" "),a("p",[s._v("（4）将动画效果应用到position属性为absolute或fixed的元素上，动画速度越快，回流次数越多。")]),s._v(" "),a("p",[s._v("（5）避免使用CSS表达式（例如：calc()）。")]),s._v(" "),a("p",[s._v("（6）使元素脱离文档流，这样的变化只会在其内容范围内发生重排（回流），不会影响其他元素。")]),s._v(" "),a("h3",{attrs:{id:"_2、javascript"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、javascript"}},[s._v("#")]),s._v(" 2、JavaScript")]),s._v(" "),a("p",[s._v("（1）避免频繁操作样式，最好一次性重写style属性，或者将样式列表定义为class并一次性更改class属性。")]),s._v(" "),a("p",[s._v("（2）避免频繁操作DOM，创建一个documentFragment，在它上面应用所有DOM操作，最后再把它添加到文档中。")]),s._v(" "),a("p",[s._v("（3）也可以先为元素设置display: none，操作结束后再把它显示出来。因为在display属性为none的元素上进行的DOM操作不会引发回流和重绘。")]),s._v(" "),a("p",[s._v("（4）避免频繁读取会引发回流/重绘的属性，如果确实需要多次使用，就用一个变量缓存起来。")]),s._v(" "),a("p",[s._v("（5）对具有复杂动画的元素使用绝对定位，使它脱离文档流，否则会引起父元素及后续元素频繁回流。")]),s._v(" "),a("h2",{attrs:{id:"八、牛刀小试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、牛刀小试"}},[s._v("#")]),s._v(" 八、牛刀小试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<div id="app">\n</div>\n<script>\n    let el = document.getElementById("app");\n    el.style.width = (el.offsetWidth + 1) + "px";\n    el.style.width = 1 + "px";\n<\/script>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("问：发生了几次重排几次重绘？")]),s._v(" "),a("p",[s._v("思路：确定引起回流和重绘的操作，结合考虑浏览器的优化。")]),s._v(" "),a("p",[s._v("答案：一次重排一次重绘。")])])}),[],!1,null,null,null);a.default=n.exports}}]);